!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.way=b()}(this,function(){"use strict";var way,w,tagPrefix="way",EventEmitter=function(){this._watchers={},this._watchersAll={}};EventEmitter.prototype.constructor=EventEmitter,EventEmitter.prototype.watchAll=function(a){this._watchersAll=this._watchersAll||[],_w.contains(this._watchersAll,a)||this._watchersAll.push(a)},EventEmitter.prototype.watch=function(a,b){this._watchers||(this._watchers={}),this._watchers[a]=this._watchers[a]||[],this._watchers[a].push(b)},EventEmitter.prototype.findWatcherDeps=function(a){var b=[],c=_w.keys(this._watchers);return c.forEach(function(c){startsWith(a,c)&&b.push(c)}),b},EventEmitter.prototype.emitChange=function(a){this._watchers||(this._watchers={});var b=this,c=b.findWatcherDeps(a);c.forEach(function(a){b._watchers[a]&&b._watchers[a].forEach(function(c){c.apply(b,[b.get(a)])})}),b._watchersAll&&_w.isArray(b._watchersAll)&&b._watchersAll.forEach(function(c){_w.isFunction(c)&&c.apply(b,[a,b.get(a)])})};var WAY=function(){this.data={},this._bindings={},this.options={persistent:!0,timeoutInput:50,timeoutDOM:500}};WAY.prototype=Object.create(EventEmitter.prototype),WAY.constructor=WAY,WAY.prototype.dom=function(a){return this._element=w.dom(a).get(0),this},WAY.prototype.toStorage=function(a,b){var c=this,b=b||c._element,a=a||c.dom(b).getOptions(),d=c.dom(b).toJSON(a),e=c.dom(b).scope(),f=e?e+"."+a.data:a.data;return a.readonly?!1:void c.set(f,d,a)},WAY.prototype.toJSON=function(a,b){var c=this,b=b||c._element,d=c.dom(b).getValue(),a=a||c.dom(b).getOptions();return _w.isArray(a.pick)&&(d=selectNested(d,a.pick,!0)),_w.isArray(a.omit)&&(d=selectNested(d,a.omit,!1)),d},WAY.prototype.fromStorage=function(a,b){var c=this,b=b||c._element,a=a||c.dom(b).getOptions();if(a.writeonly)return!1;var d=c.dom(b).scope(),e=d?d+"."+a.data:a.data,f=c.get(e);c.dom(b).fromJSON(f,a)},WAY.prototype.fromJSON=function(a,b,c){var d=this,c=c||d._element,b=b||d.dom(c).getOptions();if(b.writeonly)return!1;if(_w.isObject(a)){_w.isArray(b.pick)&&(a=selectNested(a,b.pick,!0)),_w.isArray(b.omit)&&(a=selectNested(a,b.omit,!1));var e=_w.isObject(d.dom(c).toJSON())?d.dom(c).toJSON():{};a=_w.extend(e,a)}b.json&&(a=_json.isStringified(a)?a:_json.prettyprint(a)),d.dom(c).setValue(a,b)},WAY.prototype.getValue=function(a){var b=this,a=a||b._element,c={SELECT:function(){return w.dom(a).val()},INPUT:function(){var b=w.dom(a).type();return _w.contains(["text","password"],b)?w.dom(a).val():_w.contains(["checkbox","radio"],b)?w.dom(a).prop("checked")?w.dom(a).val():null:void 0},TEXTAREA:function(){return w.dom(a).val()}},d=function(){return w.dom(a).html()},e=w.dom(a).get(0).tagName,f=c[e]||d;return f()},WAY.prototype._transforms={uppercase:function(a){return _w.isString(a)?a.toUpperCase():a},lowercase:function(a){return _w.isString(a)?a.toLowerCase():a},reverse:function(a){return a&&a.split&&_w.isFunction(a.split)?a.split("").reverse().join(""):a}},WAY.prototype.registerTransform=function(a,b){var c=this;_w.isFunction(b)&&(c._transforms[a]=b)},WAY.prototype.setValue=function(a,b,c){var d=this,c=c||d._element,b=b||d.dom(c).getOptions();b.transform=b.transform||[],b.transform.forEach(function(b){var c=d._transforms[b]||function(a){return a};a=c(a)});var e={SELECT:function(a){w.dom(c).val(a)},INPUT:function(a){_w.isString(a)||(a=JSON.stringify(a));var b=w.dom(c).get(0).type;_w.contains(["text","password"],b)&&w.dom(c).val(a||""),_w.contains(["checkbox","radio"],b)&&(a===w.dom(c).val()?w.dom(c).prop("checked",!0):w.dom(c).prop("checked",!1))},TEXTAREA:function(a){_w.isString(a)||(a=JSON.stringify(a)),w.dom(c).val(a||"")},PRE:function(a){b.html?w.dom(c).html(a):w.dom(c).text(a)},IMG:function(a){if(!a)return a=b.default||"",w.dom(c).attr("src",a),!1;var d=function(a,b){w.dom(c).addClass("way-loading"),w.dom("img",{src:a,onerror:function(){b(!1)},onload:function(){b(!0)}})};d(a,function(d){w.dom(c).removeClass("way-loading"),d?w.dom(c).removeClass("way-error").addClass("way-success"):(a?w.dom(c).addClass("way-error"):w.dom(c).removeClass("way-error").removeClass("way-success"),a=b.default||""),w.dom(c).attr("src",a)})}},f=function(a){b.html?w.dom(c).html(a):w.dom(c).text(a)},g=w.dom(c).get(0).tagName,h=e[g]||f;h(a)},WAY.prototype.setDefault=function(a,b,c){var d=this,c=c||d._element,a=a||!1,b=b?_w.extend(d.dom(c).getOptions(),b):d.dom(c).getOptions();return b.default?void(a?d.set(b.data,b.default,b):d.dom(c).setValue(b.default,b)):!1},WAY.prototype.setDefaults=function(){var a=this,b="["+tagPrefix+"-default]",c=w.dom(b).get();for(var d in c){var e=c[d],f=a.dom(e).getOptions(),g=f.data||null,h=g?a.get(g):null;h||a.dom(e).setDefault()}},WAY.prototype.registerBindings=function(){var a=this,b="["+tagPrefix+"-data]";a._bindings={};var c=w.dom(b).get();for(var d in c){var e=c[d],f=a.dom(e).getOptions(),g=a.dom(e).scope(),b=g?g+"."+f.data:f.data;a._bindings[b]=a._bindings[b]||[],_w.contains(a._bindings[b],w.dom(e).get(0))||a._bindings[b].push(w.dom(e).get(0))}},WAY.prototype.updateBindings=function(a){var b=this;b._bindings=b._bindings||{};var c=pickAndMergeParentArrays(b._bindings,a);c.forEach(function(a){var c=w.dom(a).get(0)===w.dom(":focus").get(0)?!0:!1;c||b.dom(a).fromStorage()}),b._bindings.__all__&&b._bindings.__all__.forEach(function(a){b.dom(a).fromJSON(b.data)})},WAY.prototype.registerRepeats=function(){var a=this,b="["+tagPrefix+"-repeat]";a._repeats=a._repeats||{},a._repeatsCount=a._repeatsCount||0;var c=w.dom(b).get();for(var d in c){var e=c[d],f=a.dom(e).getOptions();a._repeats[f.repeat]=a._repeats[f.repeat]||[],a._repeats[f.repeat].push({id:a._repeatsCount,element:w.dom(e).clone(!0).removeAttr(tagPrefix+"-repeat").attr(tagPrefix+"-repeat-count",a._repeatsCount).get(0),selector:f.repeat,filter:f.filter}),w.dom(e).attr(tagPrefix+"-repeat-count",a._repeatsCount),w.dom(e).attr(tagPrefix+"-scope",f.repeat+".0"),a.updateRepeats(f.repeat),a._repeatsCount++}},WAY.prototype.updateRepeats=function(selector){var self=this;self._repeats=self._repeats||{};var repeats=pickAndMergeParentArrays(self._repeats,selector);repeats.forEach(function(repeat){var elementSelector="["+tagPrefix+'-repeat-count="'+repeat.id+'"]',currentElement=self.dom(elementSelector);if(0!==currentElement.w.length){var currentScope=currentElement.scope(),data=self.get(currentScope.substring(0,currentScope.lastIndexOf("."))),items=[];repeat.filter=repeat.filter||[];for(var key in data){_w.isArray(data)&&(key=parseInt(key)),w.dom(repeat.element).attr(tagPrefix+"-scope",repeat.selector+"."+key);var html=w.dom(repeat.element).get(0).outerHTML,m=html.match(/\$\$(key|{[^\}]+})/gi);html=html.replace(m,eval(RegExp.$1)),items.push(html)}for(var element=w.dom(elementSelector),i=1;i<element.length;i++)element.get(i).remove();element.get(0).outerHTML=items.join(""),self.registerBindings(),self.updateBindings()}})},WAY.prototype.updateForms=function(){var a=this,b="form["+tagPrefix+"-data]",c=w.dom(b).get();for(var d in c){var e=c[d],f=a.dom(e).getOptions(),g=f.data;w.dom(e).removeAttr(tagPrefix+"-data");var h=w.dom(e).find("[name]").reverse().get();for(var d in h){var i=h[d],j=w.dom(i).attr("name");if(endsWith(j,"[]")){var k=j.split("[]")[0],l="[name^='"+k+"']",m=w.dom(e).find(l).get().length;j=k+"."+m}var b=g+"."+j;f.data=b,a.dom(i).setOptions(f),w.dom(i).removeAttr("name")}}},WAY.prototype.registerDependencies=function(){this.registerBindings(),this.registerRepeats()},WAY.prototype.updateDependencies=function(a){this.updateBindings(a),this.updateRepeats(a),this.updateForms(a)},WAY.prototype.setOptions=function(a,b){var c=this,b=c._element||b;for(var d in a){var e=tagPrefix+"-"+d,f=a[d];w.dom(b).attr(e,f)}},WAY.prototype.getOptions=function(a){var b=this,a=a||b._element,c={data:null,html:!1,readonly:!1,writeonly:!1,persistent:!1};return _w.extend(c,b.dom(a).getAttrs(tagPrefix))},WAY.prototype.getAttrs=function(a,b){var c=this,b=b||c._element,d=function(a,b){var c={pick:"array",omit:"array",readonly:"boolean",writeonly:"boolean",json:"boolean",html:"boolean",persistent:"boolean"},d={array:function(a){return a.split(",")},"boolean":function(a){return"true"===a?!0:"false"===a?!1:!0}},e=function(){return b},f=c[a]||null,g=d[f]||e;return g(b)},e={},f=[].slice.call(w.dom(b).get(0).attributes);return f.forEach(function(b){var c=a&&startsWith(b.name,a+"-")?!0:!1;if(c){var f=a?b.name.slice(a.length+1,b.name.length):b.name,g=d(f,b.value);_w.contains(["transform","filter"],f)&&(g=g.split("|")),e[f]=g}}),e},WAY.prototype.scope=function(a,b){var c=this,b=b||c._element,d=tagPrefix+"-scope",e=tagPrefix+"-scope-break",f=[],g="",h="["+e+"], ["+d+"]",i=w.dom(b).parents(h).get();for(var j in i){var k=i[j];if(w.dom(k).attr(e))break;var l=w.dom(k).attr(d);f.unshift(l)}return w.dom(b).attr(d)&&f.push(w.dom(b).attr(d)),w.dom(b).attr(e)&&(f=[]),g=_w.compact(f).join(".")},WAY.prototype.get=function(a){var b=this;return void 0===a||_w.isString(a)?b.data?a?_json.get(b.data,a):b.data:{}:!1},WAY.prototype.set=function(a,b,c){if(!a)return!1;if("this"===a.split(".")[0])return console.log('Sorry, "this" is a reserved word in way.js'),!1;var d=this;if(c=c||{},a){if(!_w.isString(a))return!1;d.data=d.data||{},d.data=a?_json.set(d.data,a,b):{},d.updateDependencies(a),d.emitChange(a,b),c.persistent&&d.backup(a)}},WAY.prototype.push=function(a,b,c){if(!a)return!1;var d=this;c=c||{},a&&(d.data=a?_json.push(d.data,a,b,!0):{}),d.updateDependencies(a),d.emitChange(a,null),c.persistent&&d.backup(a)},WAY.prototype.remove=function(a,b){var c=this;b=b||{},c.data=a?_json.remove(c.data,a):{},c.updateDependencies(a),c.emitChange(a,null),b.persistent&&c.backup(a)},WAY.prototype.clear=function(){this.remove(null,{persistent:!0})},WAY.prototype.backup=function(){var a=this;if(a.options.persistent)try{var b=a.data||{};localStorage.setItem(tagPrefix,JSON.stringify(b))}catch(c){console.log("Your browser does not support localStorage.")}},WAY.prototype.restore=function(){var a=this;if(a.options.persistent)try{var b=localStorage.getItem(tagPrefix);try{b=JSON.parse(b);for(var c in b)a.set(c,b[c])}catch(d){}}catch(d){console.log("Your browser does not support localStorage.")}};var matchesSelector=function(a,b){var c=["matches","matchesSelector","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],d=null;for(var e in c)if(d=c[e],_w.isFunction(a[d]))return a[d](b);return!1},startsWith=function(a,b){return""===b?!0:null===a||null===b?!1:(a=String(a),b=String(b),a.length>=b.length&&a.slice(0,b.length)===b)},endsWith=function(a,b){return""===b?!0:null===a||null===b?!1:(a=String(a),b=String(b),a.length>=b.length&&a.slice(a.length-b.length,a.length)===b)},cleanEmptyKeys=function(a){return _w.pick(a,_w.compact(_w.keys(a)))},filterStartingWith=function(a,b,c){var d=_w.keys(a);return d.forEach(function(d){c?startsWith(d,b)||delete a[d]:startsWith(d,b)&&delete a[d]}),a},selectNested=function(a,b,c){var d=_json.flatten(a);for(var e in b)d=filterStartingWith(d,b[e],c);var f=_json.unflatten(d);return cleanEmptyKeys(f)},pickAndMergeParentArrays=function(a,b){var c=[];if(b){var d=b.split("."),e=d[d.length-1],f=!isNaN(e);if(f){d.pop();var g=d.join(".");c=a[g]?_w.union(c,a[g]):c}for(var g in a)startsWith(g,b)&&(c=_w.union(c,a[g]))}else for(var g in a)c=_w.union(c,a[g]);return c},isPrintableKey=function(a){var b=a.keyCode;if(!b)return!0;var c=8===b||b>47&&58>b||32===b||13===b||b>64&&91>b||b>95&&112>b||b>185&&193>b||b>218&&223>b;return c},escapeHTML=function(a){return a&&_w.isString(a)?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a},_w={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,flatten=function(a,b,c,d){if(b&&_w.every(a,_w.isArray))return concat.apply(d,a);for(var e=0,f=a.length;f>e;e++){var g=a[e];_w.isArray(g)||_w.isArguments(g)?b?push.apply(d,g):flatten(g,b,c,d):c||d.push(g)}return d},createCallback=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}};_w.compact=function(a){return _w.filter(a,_w.identity)},_w.filter=function(a,b,c){var d=[];return null==a?d:(b=_w.iteratee(b,c),_w.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d)},_w.identity=function(a){return a},_w.every=function(a,b,c){if(null==a)return!0;b=_w.iteratee(b,c);var d,e,f=a.length!==+a.length&&_w.keys(a),g=(f||a).length;for(d=0;g>d;d++)if(e=f?f[d]:d,!b(a[e],e,a))return!1;return!0},_w.union=function(){return _w.uniq(flatten(arguments,!0,!0,[]))},_w.uniq=function(a,b,c,d){if(null==a)return[];_w.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=_w.iteratee(c,d));for(var e=[],f=[],g=0,h=a.length;h>g;g++){var i=a[g];if(b)g&&f===i||e.push(i),f=i;else if(c){var j=c(i,g,a);_w.indexOf(f,j)<0&&(f.push(j),e.push(i))}else _w.indexOf(e,i)<0&&e.push(i)}return e},_w.pick=function(a,b,c){var d,e={};if(null==a)return e;if(_w.isFunction(b)){b=createCallback(b,c);for(d in a){var f=a[d];b(f,d,a)&&(e[d]=f)}}else{var g=concat.apply([],slice.call(arguments,1));a=new Object(a);for(var h=0,i=g.length;i>h;h++)d=g[h],d in a&&(e[d]=a[d])}return e},_w.has=function(a,b){return null!=a&&hasOwnProperty.call(a,b)},_w.keys=function(a){if(!_w.isObject(a))return[];if(nativeKeys)return nativeKeys(a);var b=[];for(var c in a)_w.has(a,c)&&b.push(c);return b},_w.contains=function(a,b){return null==a?!1:(a.length!==+a.length&&(a=_w.values(a)),_w.indexOf(a,b)>=0)},_w.sortedIndex=function(a,b,c,d){c=_w.iteratee(c,d,1);for(var e=c(b),f=0,g=a.length;g>f;){var h=f+g>>>1;c(a[h])<e?f=h+1:g=h}return f},_w.property=function(a){return function(b){return b[a]}},_w.iteratee=function(a,b,c){return null==a?_w.identity:_w.isFunction(a)?createCallback(a,b,c):_w.isObject(a)?_w.matches(a):_w.property(a)},_w.pairs=function(a){for(var b=_w.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},_w.matches=function(a){var b=_w.pairs(a),c=b.length;return function(a){if(null==a)return!c;a=new Object(a);for(var d=0;c>d;d++){var e=b[d],f=e[0];if(e[1]!==a[f]||!(f in a))return!1}return!0}},_w.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=_w.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}for(;e>d;d++)if(a[d]===b)return d;return-1},_w.values=function(a){for(var b=_w.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},_w.extend=function(a){if(!_w.isObject(a))return a;for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a},_w.isArray=function(a){return"[object Array]"===toString.call(a)},_w.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===toString.call(a)},_w.isUndefined=function(a){return void 0===a},_w.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},_w.each=function(a,b,c){if(null==a)return a;b=createCallback(b,c);var d,e=a.length;if(e===+e)for(d=0;e>d;d++)b(a[d],d,a);else{var f=_w.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},_w.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){_w["is"+a]=function(b){return toString.call(b)==="[object "+a+"]"}});var deepJSON=function(a,b,c,d){var e,f=b.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split("."),g=0,h=f.length;if(arguments.length>2){for(e=a,h--;h>g;)b=f[g++],a=a[b]=_w.isObject(a[b])?a[b]:{};d?_w.isArray(a)?a.splice(f[g],1):delete a[f[g]]:a[f[g]]=c,c=e}else{for(;null!=(a=a[f[g++]])&&h>g;);c=h>g?void 0:a}return c},_json={};_json.VERSION="0.1.0",_json.debug=!0,_json.exit=function(a,b,c,d){if(_json.debug){var e={};e.noJSON="Not a JSON",e.noString="Not a String",e.noArray="Not an Array",e.missing="Missing argument";var f={source:a,data:c,value:d};f.message=e[b]?e[b]:"No particular reason",console.log("Error",f)}},_json.is=function(a){return"[object Object]"==toString.call(a)},_json.isStringified=function(a){var b=!1;try{b=/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}catch(c){}return b},_json.get=function(a,b){return void 0==a?_json.exit("get","missing","json",a):void 0==b?_json.exit("get","missing","selector",b):_w.isString(b)?deepJSON(a,b):_json.exit("get","noString","selector",b)},_json.set=function(a,b,c){return void 0==a?_json.exit("set","missing","json",a):void 0==b?_json.exit("set","missing","selector",b):_w.isString(b)?c?deepJSON(a,b,c):_json.remove(a,b):_json.exit("set","noString","selector",b)},_json.remove=function(a,b){return void 0==a?_json.exit("remove","missing","json",a):void 0==b?_json.exit("remove","missing","selector",b):_w.isString(b)?deepJSON(a,b,null,!0):_json.exit("remove","noString","selector",b)},_json.push=function(a,b,c,d){if(void 0==a)return _json.exit("push","missing","json",a);if(void 0==b)return _json.exit("push","missing","selector",b);var e=_json.get(a,b);if(!_w.isArray(e)){if(!d)return _json.exit("push","noArray","array",e);e=[]}return e.push(c),_json.set(a,b,e)},_json.unshift=function(a,b,c){if(void 0==a)return _json.exit("unshift","missing","json",a);if(void 0==b)return _json.exit("unshift","missing","selector",b);if(void 0==c)return _json.exit("unshift","missing","value",c);var d=_json.get(a,b);return _w.isArray(d)?(d.unshift(c),_json.set(a,b,d)):_json.exit("unshift","noArray","array",d)},_json.flatten=function(a){function b(a,d){if(Object(a)!==a)c[d]=a;else if(Array.isArray(a))for(var e=0,f=a.length;f>e;e++)b(a[e],d?d+"."+e:""+e),0==f&&(c[d]=[]);else{var g=!0;for(var h in a)g=!1,b(a[h],d?d+"."+h:h);g&&(c[d]={})}}if("Object"!=a.constructor.name)return _json.exit("flatten","noJSON","json",a);var c={};return b(a,""),c},_json.unflatten=function(a){if(Object(a)!==a||Array.isArray(a))return a;var b,c,d,e,f,g={};for(var h in a){b=g,c="",e=0;do d=h.indexOf(".",e),f=h.substring(e,-1!==d?d:void 0),b=b[c]||(b[c]=isNaN(parseInt(f))?{}:[]),c=f,e=d+1;while(d>=0);b[c]=a[h]}return g[""]},_json.prettyprint=function(a){return JSON.stringify(a,void 0,2)};var wQuery=function(){};wQuery.constructor=wQuery,wQuery.prototype.dom=function(a,b){var c=this,d=[];if(!b)return _w.isString(a)?d=[].slice.call(document.querySelectorAll(a)):_w.isObject(a)&&a.attributes&&(d=[a]),c._elements=d,c.length=d.length,c;var e=document.createElement(a);for(var f in b)e[f]=b[f]},wQuery.prototype.on=function(a,b){var c=this,d=c._elements;a=a.split(" ");for(var e=0,f=d.length;f>e;e++)for(var g=d[e],h=0,i=a.length;i>h;h++)g.addEventListener&&g.addEventListener(a[h],b,!1)},wQuery.prototype.find=function(a){var b=this,c=b.get(0),d=[];return _w.isString(a)&&(d=[].slice.call(c.querySelectorAll(a))),b._elements=d,b},wQuery.prototype.get=function(a,b){var c=this,d=c._elements||[],e=d[a]||{};return b?(c._element=e,c):_w.isNumber(a)?e:d},wQuery.prototype.reverse=function(){return this._elements=this._elements.reverse(),this},wQuery.prototype.val=function(a){return this.prop("value",a)},wQuery.prototype.type=function(a){return this.prop("type",a)},wQuery.prototype.html=function(a){return this.prop("innerHTML",a)},wQuery.prototype.text=function(a){return this.prop("innerHTML",escapeHTML(a))},wQuery.prototype.prop=function(a,b){var c=this,d=c._elements;for(var e in d){if(_w.isUndefined(b))return d[e][a];d[e][a]=b}},wQuery.prototype.attr=function(a,b){var c=this,d=c._elements;for(var e in d){if(void 0===b)return d[e].getAttribute(a);d[e].setAttribute(a,b)}return c},wQuery.prototype.removeAttr=function(a){var b=this;for(var c in b._elements)b._elements[c].removeAttribute(a);return b},wQuery.prototype.addClass=function(a){var b=this;for(var c in b._elements)b._elements[c].classList.add(a);return b},wQuery.prototype.removeClass=function(a){var b=this;for(var c in b._elements)b._elements[c].classList.remove(a);return b},wQuery.prototype.parents=function(a){for(var b=this,c=b.get(0),d=c.parentNode,e=[];null!==d;){var f=d,g=matchesSelector(f,a),h=void 0===f.doctype?!0:!1;a||(g=!0),g&&h&&e.push(f),d=f.parentNode}return b._elements=e,b},wQuery.prototype.parent=function(a){var b=this,c=b.get(0),d=c.parentNode,e=matchesSelector(d,a);return a||(e=!0),e?d:{}},wQuery.prototype.clone=function(a){var b=this,c=b.get(0),d=c.cloneNode(!0);return b._elements=[d],a?b:d},wQuery.prototype.empty=function(a){var b=this,c=b.get(0);if(!c||!c.hasChildNodes)return a?b:c;for(;c.hasChildNodes();)c.removeChild(c.lastChild);return a?b:c},wQuery.prototype.replaceWith=function(a){var b=this,c=b.get(0),d=c.parentNode;d.replaceChild(a,c)},wQuery.prototype.ready=function(a){document&&_w.isFunction(document.addEventListener)?document.addEventListener("DOMContentLoaded",a,!1):window&&_w.isFunction(window.addEventListener)?window.addEventListener("load",a,!1):document.onreadystatechange=function(){"complete"===document.readyState&&a()}},way=new WAY;var timeoutInput=null,eventInputChange=function(a){timeoutInput&&clearTimeout(timeoutInput),timeoutInput=setTimeout(function(){var b=w.dom(a.target).get(0);way.dom(b).toStorage()},way.options.timeout)},eventClear=function(a){a.preventDefault();var b=way.dom(this).getOptions();way.remove(b.data,b)},eventPush=function(a){a.preventDefault();var b=way.dom(this).getOptions();if(!b||!b["action-push"])return!1;var c=b["action-push"].split(":"),d=c[0]||null,e=c[1]||null;way.push(d,e,b)},eventRemove=function(a){a.preventDefault();var b=way.dom(this).getOptions();return b&&b["action-remove"]?void way.remove(b["action-remove"],b):!1},timeoutDOM=null,eventDOMChange=function(){timeoutDOM&&clearTimeout(timeoutDOM),timeoutDOM=setTimeout(function(){way.registerDependencies(),setEventListeners()},way.options.timeoutDOM)};w=new wQuery,way.w=w;var setEventListeners=function(){w.dom("body").on("DOMSubtreeModified",eventDOMChange),w.dom("["+tagPrefix+"-data]").on("input change",eventInputChange),w.dom("["+tagPrefix+"-clear]").on("click",eventClear),w.dom("["+tagPrefix+"-action-remove]").on("click",eventRemove),w.dom("["+tagPrefix+"-action-push]").on("click",eventPush)},eventInit=function(){setEventListeners(),way.restore(),way.setDefaults(),way.registerDependencies(),way.updateDependencies()};return w.ready(eventInit),way});